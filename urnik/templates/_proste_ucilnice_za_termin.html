{% load tags %}
<div class="proste-ucilnice-wrapper" style="{{ termin.style }}">
  <div class="proste-ucilnice-container" style="background-color: hsl({{ termin.hue }}, 100%, 95%);">
    <span class="proste-ucilnice-list ucilnice-list">
      {# proste učilnice #}
      {% for stanje, ucilnica, razlog in termin.prikazane_ucilnice %}
        <span class="ucilnica ucilnica-id-{{ ucilnica.pk }} ucilnica-stanje-{{ stanje }}">
          <span class="ucilnica-ime">
            <a href="{% url 'urnik_ucilnice' ucilnica.pk %}">
              {{ ucilnica.kratko_ime }}</a></span>{% if not forloop.last %},{% endif %}
          <span class="hover-area"></span>
          <span class="ucilnica-tooltip">
            {% if stanje == 'prosta' %}
              {% if teden %}
                {% with teden|dan_v_tednu:termin.dan as dan %}
                  <a href="{% url 'urnik_ucilnice' ucilnica.pk %}">Učilnica {{ ucilnica.oznaka }}</a>
                  je {{ dan|date:"j. n Y" }} ob {{ termin.ura }}ih prosta.
                  {# Če želimo, lahko naslednji link prikažemo samo, če je user logged in; če ni, ga klik na link avtomatično vrže na log in page. #}
                  {# if user.is_authenticated #}
                  <a href="{% url 'rezervacije_admin_site:urnik_rezervacija_add' %}?ucilnice={{ ucilnica.id }}&amp;od={{ termin.ura }}&amp;do={{ termin.ura|add:1 }}{% if teden %}&amp;dan={{ dan|date:"Y-m-d" }}{% endif %}" class="nobr">Rezerviraj <i class="material-icons">open_in_new</i></a>
                  {# endif #}
                {% endwith %}
              {% else %}
                V <a href="{% url 'urnik_ucilnice' ucilnica.pk %}">učilnici {{ ucilnica.oznaka }}</a> ob {{ termin.dan|dan_tozilnik_mnozina }} ob {{ termin.ura }}ih ni predavanj.
                <a href="{% url 'rezervacije_admin_site:urnik_rezervacija_add' %}?ucilnice={{ ucilnica.id }}&amp;od={{ termin.ura }}&amp;do={{ termin.ura|add:1 }}" class="nobr">Rezerviraj <i class="material-icons">open_in_new</i></a>
              {% endif %}
            {% elif stanje == 'rezervirana' %}
              <a href="{% url 'urnik_ucilnice' ucilnica.pk %}">Učilnico {{ ucilnica.oznaka }}</a>
              je od {{ razlog.od }}ih do {{ razlog.do }}ih rezervirala oseba
              {% if razlog.osebe.all.0 %}
                <a href="{% url 'urnik_osebe' razlog.osebe.all.0.pk %}">{{ razlog.osebe.all.0 }}</a>
              {% else %}
                neznan
              {% endif %}
              z razlogom: &quot;{{ razlog.opomba|default:"neznan" }}&quot;.
            {% elif stanje == 'zasedena' %}
              <a href="{% url 'urnik_ucilnice' ucilnica.pk %}">Učilnica {{ ucilnica.oznaka }}</a>
              je zasedena ob {{ razlog.dan | dan_tozilnik_mnozina }} ob {{ razlog.ura }}ih,
              saj tam poteka predmet <a href="{% url 'urnik_predmeta' razlog.predmet.pk %}">
              &quot;{{ razlog.predmet }}&quot;</a>, ki ga izvaja
              {% if razlog.ucitelji.all.0 %}
                <a href="{% url 'urnik_osebe' razlog.ucitelji.all.0.pk %}">{{ razlog.ucitelji.all.0 }}</a>.
              {% else %}
                neznana oseba.
              {% endif %}
            {% endif %}
          </span>
        </span>
      {% empty %}
        /
      {% endfor %}
    </span>
  </div>
</div>
